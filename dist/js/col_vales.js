"use strict";var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}();function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var InputField=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){var t=this,e=(void 0!==this.props.cols?this.props.cols:"")+" field ",a="true"==this.props.mayuscula?"mayuscula":"";return React.createElement("div",{className:e},React.createElement("label",null,this.props.label),React.createElement("div",{className:"ui icon input"},React.createElement("input",{className:a,id:this.props.id,readOnly:this.props.readOnly,name:this.props.id,type:"text",value:this.props.valor,placeholder:this.props.placeholder,onChange:function(e){return t.props.onChange(e)}})))}}]),t}(),Mensaje=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={icon:"send icon",titulo:"Guardar",pregunta:"¿Desea enviar el registro?"},t}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"ui mini test modal scrolling transition hidden"},React.createElement("div",{className:"ui icon header"},React.createElement("i",{className:this.props.icon}),this.props.titulo),React.createElement("div",{className:"center aligned content "},React.createElement("p",null,this.props.pregunta)),React.createElement("div",{className:"actions"},React.createElement("div",{className:"ui red cancel basic button"},React.createElement("i",{className:"remove icon"})," No "),React.createElement("div",{className:"ui green ok basic button"},React.createElement("i",{className:"checkmark icon"})," Si ")))}}]),a}(),SelectDropDown=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={value:""},t.handleSelectChange=t.handleSelectChange.bind(t),t}return _inherits(a,React.Component),_createClass(a,[{key:"handleSelectChange",value:function(e){this.props.onChange(e),this.setState({value:e.target.value})}},{key:"componentDidMount",value:function(){$(ReactDOM.findDOMNode(this.refs.myDrop)).on("change",this.handleSelectChange)}},{key:"render",value:function(){var e=(void 0!==this.props.cols?this.props.cols:"")+" field ",t=this.props.valores.map(function(e){return React.createElement("div",{className:"item","data-value":e.value},e.name)});return React.createElement("div",{className:e},React.createElement("label",null,this.props.label),React.createElement("div",{className:"ui fluid search selection dropdown"},React.createElement("input",{type:"hidden",ref:"myDrop",value:this.value,name:this.props.id,onChange:this.handleSelectChange}),React.createElement("i",{className:"dropdown icon"}),React.createElement("div",{className:"default text"},"Seleccione"),React.createElement("div",{className:"menu"},t)))}}]),a}(),SelectOption=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={value:0},t}return _inherits(a,React.Component),_createClass(a,[{key:"handleSelectChange",value:function(e){this.setState({value:e.target.value}),this.props.onChange(e)}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=(void 0!==this.props.cols?this.props.cols:"")+" field ",t=this.props.valores.map(function(e){return React.createElement("option",{key:e.value,value:e.value},e.name)});return React.createElement("div",{className:e},React.createElement("label",null,this.props.label),React.createElement("select",{className:"ui fluid dropdown",ref:"myCombo",name:this.props.id,id:this.props.id,onChange:this.handleSelectChange.bind(this)},React.createElement("option",{key:"0",value:this.props.valor},"Seleccione"),t))}}]),a}();function Lista(e){var t=e.enca,a=0,n={display:"none"},s={display:"display"},i=t.map(function(e){return React.createElement("th",{key:a++,style:"Id"==e?n:s},e)});return React.createElement("tr",null,i)}var RecordDetalle=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("tr",null,React.createElement("td",{style:{display:"none"}},React.createElement("input",{type:"text",className:"styleNo table-input",id:"idpromotor[]",name:"idpromotor[]",value:this.props.registro.idpromotor})," "),React.createElement("td",null,this.props.registro.nompromotor),React.createElement("td",null,React.createElement("input",{type:"text",readOnly:"readOnly",className:"table-input",id:"fecha[]",name:"fecha[]",value:this.props.registro.fecha})," "),React.createElement("td",null,React.createElement("input",{type:"text",readOnly:"readOnly",className:"styleNo table-input",id:"vale[]",name:"vale[]",value:this.props.registro.vale})," "))}}]),t}(),Table=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.handleChange=t.handleChange.bind(t),t}return _inherits(a,React.Component),_createClass(a,[{key:"handleChange",value:function(e,t){this.props.onChange(e,t)}},{key:"render",value:function(){var t=[],e=this.props.datos;e instanceof Array==!0&&e.forEach(function(e){t.push(React.createElement(RecordDetalle,{registro:e,onChange:this.handleChange}))}.bind(this));return React.createElement("div",null,React.createElement("table",{className:"ui selectable celled blue table"},React.createElement("thead",null,React.createElement(Lista,{enca:["Id","Promotor","Fecha","No. Vale","Accion"]})),React.createElement("tbody",null,t)))}}]),a}(),Captura=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={anio:0,semana:0,novale:"",catAnios:[],catSemanas:[],catPromotores:[],supervisor:!1,notavis:!1,icon:"send icon",titulo:"Guardar",pregunta:"¿Desea enviar el registro?"},t}return _inherits(a,React.Component),_createClass(a,[{key:"componentWillMount",value:function(){var e=$("#csrf").val();this.setState({csrf:e});for(var t=getWeekNo(),a=[],n=1;n<=t;n++){if(1==t&&1==n){a.push({"value:":52,name:52})}var s={"value:":n,name:n};a.push(s)}this.setState({catSemanas:a});this.setState({catAnios:[{value:2019,name:2019}]})}},{key:"handleSubmit",value:function(e){e.preventDefault(),$(".ui.form.formgen").form({inline:!0,on:"blur",fields:{anio:{identifier:"anio",rules:[{type:"empty",prompt:"Requiere un valor"}]},semana:{identifier:"semana",rules:[{type:"empty",prompt:"Requiere un valor"}]},novale:{identifier:"novale",rules:[{type:"empty",prompt:"Requiere un valor"}]},vale:{identifier:"vale",rules:[{type:"empty",prompt:"Requiere un valor"}]}}}),$(".ui.form.formgen").form("validate form");var t=$(".ui.form.formgen").form("is valid");if(this.setState({message:"",statusmessage:"ui message hidden"}),1==t){var a=$(".get.soling form"),n=a.form("get values"),s=a.form("get value","csrf_bancomunidad_token"),i=this;$(".mini.modal").modal({closable:!1,onApprove:function(){var e={url:base_url+"api/ColmenasV1/add_vales",type:"PUT",dataType:"json",data:{csrf_bancomunidad_token:s,data:n}};ajax(e).then(function(e){i.setState({csrf:e.newtoken,message:e.message,statusmessage:"ui positive floating message ",novale:"",catPromotores:[]}),i.autoReset();$(".get.soling form").form("set values",{semana:"0",anio:0})},function(e){var t=validaError(e);i.setState({csrf:t.newtoken,message:t.message,statusmessage:"ui negative floating message"}),i.autoReset()})}}).modal("show")}else this.setState({message:"Datos incompletos!",statusmessage:"ui negative floating message"}),this.autoReset()}},{key:"handleButton",value:function(){}},{key:"handleReversa",value:function(){}},{key:"handleChangeTotal",value:function(e,t){var a=numeral(t).format("0,0.00");this.setState({pagototal:a})}},{key:"handleInputChange",value:function(e){var t=e.target,a=t.value,n=t.name;this.setState(_defineProperty({},n,a)),"semana"!=n&&"anio"!=n||""!=a&&("semana"==n&&""!=this.state.anio?this.findPromotores(this.state.anio,a):"idanio"==n&&""!=this.state.semana&&this.findPromotores(a,this.state.semana))}},{key:"findPromotores",value:function(e,t){$.ajax({url:base_url+"/api/Colmenasv1/promotores/"+e+"/"+t,type:"GET",dataType:"json",success:function(e){this.setState({catPromotores:e.result,supervisor:e.asignado})}.bind(this),error:function(e,t,a){console.log("error")}.bind(this)})}},{key:"handleGenera",value:function(){var e=this.state.novale;if(""!=e)for(var t=0;t<this.state.catPromotores.length;t++){this.state.catPromotores[t].vale=e,this.setState(function(e){return{}}),e++}}},{key:"autoReset",value:function(){var e=this;window.clearTimeout(e.timeout),this.timeout=window.setTimeout(function(){e.setState({message:"",statusmessage:"ui message hidden"})},5e3)}},{key:"render",value:function(){var t=this,e=this.state.statusmessage+" close icon",a=null,n=null,s=null;return 0==this.state.supervisor&&(s=React.createElement(InputField,{id:"novale",label:"Vale Inicial",cols:"two wide",valor:this.state.novale,onChange:this.handleInputChange.bind(this)}),a=React.createElement("button",{className:!0===this.state.notavis?"ui submit bottom primary basic button disabled":"ui submit bottom primary basic button",type:"submit",name:"action"},React.createElement("i",{className:"send icon"}),"Enviar"),n=React.createElement("button",{className:"ui bottom primary basic button",type:"button",name:"genera",onClick:this.handleGenera.bind(this)},React.createElement("i",{className:"send icon"}),"Genera")),React.createElement("div",{className:"main ui intro  top"},React.createElement("div",{className:"ui segment vertical"},React.createElement("div",{className:"row"},React.createElement("h3",{className:"ui rojo header"},"Control de vales"))),React.createElement("div",{className:"ui secondary menu"},React.createElement("div",{className:"ui basic icon buttons"},React.createElement("button",{className:"ui button","data-tooltip":"Último movimiento",onClick:this.handleButton.bind(this,20)},React.createElement("i",{className:"file pdf outline icon",onClick:this.handleButton.bind(this,20)})))),React.createElement("div",{className:"get soling"},React.createElement("form",{className:"ui form formgen",ref:"form",onSubmit:this.handleSubmit.bind(this),method:"post"},React.createElement("input",{type:"hidden",name:"csrf_bancomunidad_token",value:this.state.csrf}),React.createElement("div",{className:"fields"},React.createElement(SelectDropDown,{name:"anio",cols:"five wide",id:"anio",label:"Año",valor:this.state.anio,valores:this.state.catAnios,onChange:this.handleInputChange.bind(this)}),React.createElement(SelectOption,{name:"semana",cols:"three wide",id:"semana",label:"Semana",valor:this.state.semana,valores:this.state.catSemanas,onChange:this.handleInputChange.bind(this)}),s,React.createElement("div",{className:"ui vertical segment eight wide field right aligned"},React.createElement("div",{className:"field"},n))),React.createElement(Mensaje,{icon:this.state.icon,titulo:this.state.titulo,pregunta:this.state.pregunta}),React.createElement("div",{className:"thirteen wide column"},React.createElement("div",{className:this.state.statusmessage},React.createElement("p",null,React.createElement("b",null,this.state.message)),React.createElement("i",{className:e,onClick:function(e){window.clearTimeout(t.timeout),t.setState({message:"",statusmessage:"ui message hidden"})}}))),React.createElement("div",{id:"pagares",className:"row"},React.createElement("div",{className:"row"},React.createElement(Table,{datos:this.state.catPromotores,onChange:this.handleChangeTotal.bind(this)})),React.createElement("div",{className:"ui vertical segment right aligned"},React.createElement("div",{className:"field"},a))))))}}]),a}();ReactDOM.render(React.createElement(Captura,null),document.getElementById("root"));