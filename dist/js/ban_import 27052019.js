"use strict";var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Calendar=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.handleChange=t.handleChange.bind(t),t}return _inherits(a,React.Component),_createClass(a,[{key:"handleChange",value:function(e){}},{key:"componentDidMount",value:function(){$(ReactDOM.findDOMNode(this.refs.myCalen)).on("onChange",this.handleChange)}},{key:"render",value:function(){var e="ui calendar "+(!1===this.props.visible?" hidden ":"");return React.createElement("div",{className:e,id:this.props.name},React.createElement("div",{className:"field"},React.createElement("label",null,this.props.label),React.createElement("div",{className:"ui input left icon"},React.createElement("i",{className:"calendar icon"}),React.createElement("input",{ref:"myCalen",type:"text",name:this.props.name,id:this.props.name,placeholder:"Fecha",onChange:this.handleChange}))))}}]),a}(),SelectOption=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={value:""},t}return _inherits(a,React.Component),_createClass(a,[{key:"handleSelectChange",value:function(e){this.props.onChange(e)}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=(void 0!==this.props.cols?this.props.cols:"")+" inline field ",t=this.props.valores.map(function(e){return React.createElement("option",{value:e.value},e.name)});return React.createElement("div",{className:e},React.createElement("label",null,this.props.label),React.createElement("select",{className:"ui fluid dropdown",ref:"myCombo",name:this.props.id,id:this.props.id,onChange:this.handleSelectChange.bind(this)},React.createElement("option",{value:this.props.valor},"Seleccione"),t))}}]),a}(),Mensaje=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={icon:"send icon",titulo:"Guardar",pregunta:"¿Desea enviar el registro?"},t}return _inherits(a,React.Component),_createClass(a,[{key:"render",value:function(){return React.createElement("div",{className:"ui mini test modal scrolling transition hidden"},React.createElement("div",{className:"ui icon header"},React.createElement("i",{className:this.state.icon}),this.state.titulo),React.createElement("div",{className:"center aligned content "},React.createElement("p",null,this.state.pregunta)),React.createElement("div",{className:"actions"},React.createElement("div",{className:"ui red cancel basic button"},React.createElement("i",{className:"remove icon"})," No "),React.createElement("div",{className:"ui green ok basic button"},React.createElement("i",{className:"checkmark icon"})," Si ")))}}]),a}();function Lista(e){var t=e.enca,a=0,n=t.map(function(e){return React.createElement("th",{className:"two wide",key:a++},e)});return React.createElement("tr",null,n)}var RecordDetalle=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,React.Component),_createClass(t,[{key:"handleChange",value:function(e){}},{key:"render",value:function(){var e="0"==this.props.registro.estatus?"Importar":"Importado";return React.createElement("tr",null,React.createElement("td",null,this.props.registro.hora),React.createElement("td",null,this.props.registro.fecha),React.createElement("td",null,this.props.registro.autorizacion),React.createElement("td",null,this.props.registro.concepto),React.createElement("td",null,this.props.registro.deposito),React.createElement("td",null,this.props.registro.retiro),React.createElement("td",null,this.props.registro.saldo),React.createElement("td",null,this.props.registro.vale),React.createElement("td",null,this.props.registro.semana),React.createElement("td",null,this.props.registro.colmena),React.createElement("td",null,this.props.registro.grupo),React.createElement("td",null,this.props.registro.nomcolmena),React.createElement("td",null,this.props.registro.caja),React.createElement("td",null,e))}}]),t}(),Table=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.handleChange=t.handleChange.bind(t),t}return _inherits(a,React.Component),_createClass(a,[{key:"componentDidUpdate",value:function(e,t){}},{key:"handleChange",value:function(e,t){}},{key:"render",value:function(){var t=this,a=[];this.props.datos.map(function(e){return a.push(React.createElement(RecordDetalle,{registro:e,onChange:t.handleChange}))});return React.createElement("div",{className:"ui grid"},React.createElement("div",{className:"column"},React.createElement("table",{className:"ui selectable celled blue table"},React.createElement("thead",null,React.createElement(Lista,{enca:["Hora","Fecha","Autorización","Concepto","Deposito","retiro","saldo","Vale","Semana","Colmena","Grupo","Nombre Colmena","Caja","Estatus"]})),React.createElement("tbody",null,a))))}}]),a}(),Captura=function(e){function a(e){_classCallCheck(this,a);var t=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return t.state={catMov:[],catBancos:[],idbanco:0,message:"",statusmessage:"ui floating hidden message",icons1:"inverted circular search link icon",icons2:"inverted circular search link icon",fecini:"",fecfin:"",ocultar:!0,lblRegistro:"Registro 0 de 0"},t}return _inherits(a,React.Component),_createClass(a,[{key:"componentWillMount",value:function(){var e=$("#csrf").val();this.setState({csrf:e});var t={url:base_url+"api/generalv1/bancosall",type:"GET",dataType:"json"};this.setState({catBancos:[]});var a=this;ajax(t).then(function(e){a.setState({catBancos:e.result,idbanco:0})},function(e){validaError(e)})}},{key:"handleInputChange",value:function(e){var t=e.target,a="checkbox"===t.type?t.checked:t.value,n=t.name;if(this.setState(_defineProperty({},n,a)),"userfile"==n){var f=this,r=e.target.files[0],i=new FileReader,v=0;i.onload=function(e){e.target.result.split(String.fromCharCode(13)).forEach(function(e){if(15<++v){if(0<e.length){var t={hora:"",fecha:"",autorizacion:"",concepto:"",deposito:"",retiro:"",saldo:"",vale:"",semana:"",colmena:"",grupo:"",nomcolmena:"",caja:"",estatus:"0"},a=["hora","fecha","autorizacion","concepto","deposito","retiro","saldo","vale","semana","colmena","grupo","momcolmena","caja","estatus"],n=1,r=e.substr(1,1),i=e.indexOf('"');if(0<i&&'"'==r)for(;;){var c,s="",o="",l=0;if(-1==i)break;if(c=e.indexOf('"',i+1),s=e.substr(i+1,c-i-1),i=e.indexOf('"',c+1),c+1,(1<s.length||0==n)&&2==n?0!=(l=s.indexOf("Autorizaci"))&&(o=s.substr(l+14),t[a[n]]=o,n++,l=s.indexOf("Referencia N"),t[a[n]]=0!=l?s.substr(0,l)+s.substr(l+52):s,n++):(t[a[n]]=s,n++),n-2>=e.length)break}else{var u="";n=1;i=e.indexOf(",",1),u=e.substr(1,i-1),t[a[n]]=u,n++;for(var m=1;;){var d=i;if(m='"'===e.substr(i+1,1)?(i=e.indexOf('"',i+2),1):(i=e.indexOf(",",i+1),0),u=e.substr(d+m+1,i-d-(m+1)),2==n){var h=u.indexOf("Autorizaci");if(0!=h){var p=u.substr(h+14);t[a[n]]=p,n++,h=u.indexOf("Referencia N"),t[a[n]]=0!=h?u.substr(1,h-1)+u.substr(h+52):u,n++}}else t[a[n]]=u,n++;if(i+=m,8<=n)break}}}""==t.autorizacion&&"Autorizacion"==t.autorizacion||"0.00"==t.deposito||(t.estatus="0",f.setState(function(e){return{catMov:[].concat(_toConsumableArray(e.catMov),[t])}}))}})},i.readAsText(r)}}},{key:"handleButton",value:function(e,t){if(2==e){if(0!=this.state.idbanco){var a=1!=this.state.ocultar;this.setState({ocultar:a})}}else if(3==e&&0!=this.state.idbanco){var n="0",r="0";if(""!=$("#fechaini").val()){var i=$("#fechaini").val().split("/"),c=new Date(i[2],i[1]-1,i[0]);n=moment(c).format("DDMMYYYY")}if(""!=$("#fechafin").val()){var s=$("#fechafin").val().split("/"),o=new Date(s[2],s[1]-1,s[0]);r=moment(o).format("DDMMYYYY")}var l="bancosv1/getEdoCta/"+this.state.idbanco+"/"+n+"/"+r,u={url:base_url+"api/"+l,type:"GET",dataType:"json"};this.setState({catMov:[]});var m=this;ajax(u).then(function(e){m.setState({catMov:e.catmov})},function(e){validaError(e)})}}},{key:"handleImportar",value:function(){var e=this;$(".mini.modal").modal({closable:!1,onApprove:function(){e.import(e)}}).modal("show")}},{key:"import",value:function(i){for(var c=i.state.catMov.length,e=function(t){var a=i.state.catMov[t];if("0"==a.estatus){var e=$("#csrf_bancomunidad_token").val(),n=[{fecha:a.fecha,autorizacion:a.autorizacion,concepto:a.concepto,deposito:a.deposito,retiro:a.retiro,saldo:a.saldo,consecutivo:t,csrf_bancomunidad_token:e}],r={url:base_url+"api/BancosV1/add_edocta/"+i.state.idbanco,type:"PUT",dataType:"json",data:{csrf_bancomunidad_token:e,data:n}};ajax(r).then(function(e){i.setState({csrf:e.newtoken,lblRegistro:"Registro "+(t+1)+" de "+c}),a.estatus="1",i.setState(function(e){return{catMov:[].concat(_toConsumableArray(e.catMov),[a])}})},function(e){var t=validaError(e);i.setState({csrf:t.newtoken})})}},t=0;t<i.state.catMov.length;t++)e(t)}},{key:"autoReset",value:function(e){var t=this;this.timeout=window.setTimeout(function(){t.setState({message:"",statusmessage:"ui message hidden"})},e)}},{key:"render",value:function(){var t=this,e=this.state.lblRegistro;return React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("h3",{className:"ui rojo header"},"Estado de Cuenta Bancaria")),React.createElement("div",{className:"ui secondary menu"},React.createElement("div",{className:"ui  basic icon buttons"},React.createElement("button",{className:"ui button","data-tooltip":"Nuevo Registro"},React.createElement("i",{className:"plus square outline icon",onClick:this.handleButton.bind(this,0)})),React.createElement("button",{className:"ui button","data-tooltip":"Formato PDF"},React.createElement("i",{className:"file pdf outline icon",onClick:this.handleButton.bind(this,1)})),React.createElement("button",{className:"ui button","data-tooltip":"Cargar Archivo",onClick:this.handleButton.bind(this,2)},React.createElement("i",{className:"upload icon",onClick:this.handleButton.bind(this,2)}))),React.createElement("div",{className:"right menu"},React.createElement("div",{className:"item ui fluid category search"},React.createElement("div",{className:"ui icon input"},React.createElement("input",{className:"prompt mayuscula",type:"text",placeholder:"Buscar Nombre"}),React.createElement("i",{className:"search link icon"})),React.createElement("div",{className:"results"})))),React.createElement(Mensaje,null),React.createElement("div",{className:"ui form formopen"},React.createElement("input",{type:"hidden",name:"csrf_bancomunidad_token",value:this.state.csrf}),React.createElement("div",{className:"fields"},React.createElement(SelectOption,{cols:"four wide",name:"idbanco",id:"idbanco",label:"Banco:",valor:this.state.idbanco,valores:this.state.catBancos,onChange:this.handleInputChange.bind(this)}),React.createElement("div",{className:"two wide field"}),React.createElement(Calendar,{name:"fechaini",label:"Fecha Inicial",valor:this.state.fechini,onChange:this.handleInputChange.bind(this)}),React.createElement(Calendar,{name:"fechafin",label:"Fecha Final",valor:this.state.fechafin,onChange:this.handleInputChange.bind(this)}),React.createElement("div",{className:"field"},React.createElement("button",{className:"ui bottom primary basic button",type:"button",name:"action",onClick:this.handleButton.bind(this,3)}," Filtrar "))),React.createElement("div",{className:1==this.state.ocultar?"hidden":""},React.createElement("div",{className:"ui icon input"},React.createElement("input",{className:"ui bottom primary basic button",type:"file",accept:".xlsx, .csv",name:"userfile",size:"20",onChange:this.handleInputChange.bind(this)})),React.createElement("div",{className:"ui label"},e),React.createElement("div",{className:"ui vertical segment wide field right aligned"},React.createElement("div",{className:"field"},React.createElement("button",{className:"ui bottom primary basic button",type:"button",name:"importar",onClick:this.handleImportar.bind(this)},React.createElement("i",{className:"send icon"}),"Importar")))),React.createElement(Table,{name:"catMov",datos:this.state.catMov})),React.createElement("div",{className:this.state.statusmessage},React.createElement("p",null,React.createElement("b",null,this.state.message)),React.createElement("i",{className:"close icon",onClick:function(e){window.clearTimeout(t.timeout),t.setState({message:"",statusmessage:"ui message hidden"})}})))}}]),a}();ReactDOM.render(React.createElement(Captura,null),document.getElementById("root")),$(".ui.search").search({type:"category",minCharacters:8,apiSettings:{url:base_url+"api/CarteraD1/find_acreditados?q={query}",onResponse:function(e){var n={results:{}};if(e&&e.result)return $.each(e.result,function(e,t){var a=t.idacreditado||"Sin asignar";if(8<=e)return!1;void 0===n.results[a]&&(n.results[a]={name:a,results:[]}),n.results[a].results.push({title:t.nombre,description:t.idcredito+" : "+t.idpagare})}),n}}});